<html>
<head>
    <script src="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.js"></script>
</head>
<body>
<div id="app"></div>

<script>
    let jqlTZ = 'project = tianzhou AND (assignee in (Liang.Cui, Jingjun.Zhang, Qilin.Lou, Jingtian.Mo, Hongxing.Chen, Yunpeng.Ding) OR assignee was in (Liang.Cui, Jingjun.Zhang, Qilin.Lou, Jingtian.Mo, Hongxing.Chen, Yunpeng.Ding)) ORDER BY priority DESC';
    let stagesTZ = 'READY FOR DEV, In Progress, Blocked, Showcase, Done';
    function getDataTZ(){
        responseStr = fetch('https://service-pc8cr97p-1256727478.bj.apigw.tencentcs.com/release/jira/cardsCycleTime', {
            method: 'GET',
            headers: {
                'jql': jqlTZ,
                'jira-token': 'Basic cWlsaW4ubG91QG15b2IuY29tOnQySVgxeURyU2VUeHBqc3hJMHhvMEM1Nw==',
                'card-stage': stagesTZ,
            },
        }).then((response) => {
                return response.text();
            })
            .then((myJson) => {
                console.log(myJson);
                const data = eval(myJson);
                return data;
            })
            .then((data) => {
                renderGraph(data);
            });
    }
    getDataTZ();

    // const mockData = [{'jiraId':'TZ-11','totalCost':0.9,'wipCost':0.9},{'jiraId':'TZ-10','totalCost':5.1,'wipCost':0.3},{'jiraId':'TZ-7','totalCost':3,'wipCost':3},{'jiraId':'TZ-6','totalCost':0,'wipCost':0},{'jiraId':'TZ-3','totalCost':6.7,'wipCost':5.9},{'jiraId':'TZ-2','totalCost':14.6,'wipCost':4.8},];
    // renderGraph(mockData);

    function renderGraph(data) {

        const scatterPlot = new G2Plot.Scatter(document.getElementById('app'), {
            title: {
                visible: true,
                text: 'Tianzhou Team Cards Status',
            },
            description: {
                visible: true,
                text: '',
            },
            padding: 'auto',
            data: data,
            xField: 'totalCost',
            yField: 'wipCost',
            colorField: 'jiraId',
            meta: {
                totalCost: {
                    alias:'Total Cost Days',
                },
                wipCost: {
                    alias:'Work In Progress Cost Days',
                }
            },
            pointSize: 10,
            pointStyle: {
                stroke: '#777777',
                lineWidth: 1,
            },
            label: {
                visible: true,
                position: 'right', // left right top bottom middle
                formatter: (_, original) => {
                    return original._origin.jiraId;
                },
                style: 'jiraId'
            },
            trendline: {
                visible: true,
                type: 'quad', // linear, exp, loess, log, poly, pow, quad
                showConfidence: true,
            },
        });

        scatterPlot.render();
        
    }

</script>
</body>
</html>